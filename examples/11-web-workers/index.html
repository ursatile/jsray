<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="favicon.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>JSTracer: A JavaScript Ray-Tracer</title>
  <link type="text/css" rel="stylesheet" href="style.css" />
</head>

<body>
  <canvas id="my-canvas" width="640" height="480"></canvas>
  <form>
    <label for="reflection-input">Reflection: (0-1)</label>
    <input type="number" value="0.3" min="0" max="1" step="0.1" name="reflection" id="reflection-input" />
    <label for="step-input">Step Size: (1-20)</label>
    <input type="number" min="1" max="100" name="step" value="10" id="step-input" />
    <input type="button" id="render-button" value="Render" />
    <input type="button" id="cancel-button" value="Cancel" />
  </form>
  <script type="module">
    let canvas = document.getElementById('my-canvas');
    let ctx = canvas.getContext('2d');

    function handleMessage(message) {
      let data = message.data;
      switch (data.what) {
        case 'pixelRendered':
          ctx.fillStyle = data.rgb;
          ctx.fillRect(data.x, data.y, data.step, data.step);
          break;
      }
    }

    function render() {
      ctx.fillStyle = "#000";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      let reflection = parseFloat(document.forms[0].reflection.value);
      let step = parseInt(document.forms[0].step.value);
      window.worker = new Worker('main.js', { type: 'module' });
      window.worker.addEventListener('message', handleMessage);
      window.worker.postMessage({ command: 'render', width: canvas.width, height: canvas.height, reflection: reflection, step: step });
    }
    function cancel() {
      if (window.worker && window.worker.terminate) window.worker.terminate();
      window.rendering = false;
      delete window.worker;
    }

    let renderButton = document.getElementById("render-button");
    renderButton.addEventListener("click", render);
    let cancelButton = document.getElementById("cancel-button");
    cancelButton.addEventListener("click", cancel)
    render();


  </script>
</body>

</html>